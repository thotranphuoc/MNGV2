{"version":3,"sources":["../../src/pages/map/map.module.ts","../../src/pages/map/map.ts"],"names":[],"mappings":"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","file":"29.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MapPage } from './map';\n\n@NgModule({\n  declarations: [\n    MapPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MapPage),\n  ],\n  exports: [\n    MapPage\n  ]\n})\nexport class MapPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map/map.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, LoadingController } from 'ionic-angular';\n\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { GmapService } from '../../services/gmap.service';\nimport { LocalService } from '../../services/local.service';\nimport { AngularFireDatabase, FirebaseListObservable, FirebaseObjectObservable } from 'angularfire2/database';\n\nimport { iPosition } from '../../interfaces/position.interface';\nimport { iShop } from '../../interfaces/shop.interface';\n\ndeclare var google: any;\n\n@IonicPage()\n@Component({\n  selector: 'page-map',\n  templateUrl: 'map.html',\n})\nexport class MapPage {\n  mapEl: any;\n  map: any;\n  loading: any;\n  shops: iShop[] = [];\n  shopsO: FirebaseListObservable<iShop[]>;;\n  insideMapShops: iShop[] = [];\n  SHOPs_LOC: any[] = [];\n  SHOPs_NEARBY: any[] = [];\n  USER_LOC: iPosition;\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private loadingCtrl: LoadingController,\n    private geolocation: Geolocation,\n    private gmapService: GmapService,\n    private localService: LocalService,\n    private afDB: AngularFireDatabase\n  ) {\n    this.USER_LOC = this.navParams.get('LOC');\n    console.log(this.USER_LOC);\n    if (this.localService.shopsLoaded) {\n      this.SHOPs_NEARBY = this.localService.SHOPs_NEARBY;\n      this.SHOPs_LOC = this.localService.SHOPs_LOCATION;\n    } else {\n      this.afDB.list('ShopsLOCATION')\n      // this.afDB.list('ShopsLOCATION')\n      .forEach((shops_loc: any[]) => {\n        this.localService.SHOPs_LOCATION = shops_loc;\n        this.SHOPs_LOC = shops_loc;\n        // this.shopsLoaded = true;\n        this.localService.shopsLoaded = true;\n        console.log(this.SHOPs_LOC);\n      })\n    }\n\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait....',\n      spinner: 'crescent'\n    });\n  }\n\n  ionViewWillEnter() {\n    console.log('ionViewWillEnter ...');\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad MapPage');\n    this.startLoading();\n    setTimeout(() => {\n      this.mapEl = document.getElementById('map');\n      this.initMap(this.mapEl)\n    }, 1000)\n  }\n\n  initMap(mapElement) {\n    // this.gmapService.getCurrentPosition()\n    this.geolocation.getCurrentPosition()\n      .then((position) => {\n        let latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\n        let pos: iPosition = { lat: position.coords.latitude, lng: position.coords.longitude }\n        this.gmapService.setUserCurrentPosition(pos);\n        this.showMap(pos, mapElement)\n      })\n      .catch((err) => {\n        this.gmapService.getUserCurrentPosition()\n          .then((position: iPosition) => {\n            console.log(position);\n            this.showMap(position, mapElement)\n            this.gmapService.setUserCurrentPosition(position);\n          }, err => {\n            console.log(err);\n            alert('No gps signal. Your location cannot be detected now.');\n            let pos: iPosition = { lat: 10.778168043677463, lng: 106.69638633728027 };\n            this.gmapService.setUserCurrentPosition(pos);\n            this.showMap(pos, mapElement);\n          })\n      })\n\n  }\n\n\n\n  showMap(position: iPosition, mapElement) {\n    let latLng = new google.maps.LatLng(position.lat, position.lng);\n    let mapOptions = {\n      center: latLng,\n      zoom: 15,\n      mapTypeId: google.maps.MapTypeId.ROADMAP,\n      mapTypeControl: false,\n      zoomControl: false,\n      fullscreenControl: false\n    }\n\n    console.log(mapElement, mapOptions);\n    this.gmapService.initMap(mapElement, mapOptions)\n      .then((map) => {\n        console.log(map);\n        this.map = map;\n        // when maps is loaded and become idle\n        google.maps.event.addListener(this.map, 'idle', () => {\n          console.log('map was loaded fully');\n          this.hideLoading();\n          this.loadShops();\n        })\n      })\n  }\n\n  loadShops() {\n    if (!this.localService.shopsLoaded) {\n      // this.shops = [];\n      this.afDB.list('Shops_LOC').forEach((shops_loc: any[]) => {\n        console.log(shops_loc);\n        this.SHOPs_LOC = shops_loc;\n        this.localService.shopsLoaded = true;\n        this.checkAndLoadMarker(this.SHOPs_LOC);\n      })\n    }else{\n      this.checkAndLoadMarker(this.SHOPs_LOC);\n    }\n    \n  }\n\n  checkAndLoadMarker(shops: any[]) {\n    if(shops.length>0){\n      console.log(shops);\n      this.insideMapShops = [];\n      shops.forEach(shop => {\n        let POS: iPosition = {lat: shop.lat, lng: shop.lng}\n        console.log(POS);\n        if (this.gmapService.isPositionInsideMap(POS, this.map)) {\n          this.afDB.object('Shops/' + shop.ID).subscribe((shopData: iShop) => {\n            console.log(shopData);\n            this.gmapService.addMarkerToMapWithIDReturnPromiseWithMarker(this.map, POS, shopData);\n            this.insideMapShops.push(shopData);\n          })\n  \n        }else{\n          console.log('out of map');\n        }\n      })\n    }\n  }\n\n\n\n\n  private startLoading() {\n    this.loading.present();\n    setTimeout(() => {\n      this.hideLoading();\n      // alert('Please turn on internet and location permission. Then open app again')\n    }, 15000)\n  }\n\n  private hideLoading() {\n    this.loading.dismiss();\n  }\n\n  go2List() {\n    console.log('go2ListPage');\n    this.navCtrl.push('ListPage', { shops: this.insideMapShops });\n  }\n\n  go2AddNewShop() {\n    this.navCtrl.push('ShopAddNewPage');\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map/map.ts"],"sourceRoot":""}