{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"24.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HomePage } from './home';\n\n@NgModule({\n  declarations: [\n    HomePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(HomePage),\n  ],\n  exports: [\n    HomePage\n  ]\n})\nexport class HomePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\n\nimport { DbService } from '../../services/db.service';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { iPosition } from '../../interfaces/position.interface';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { AppService } from '../../services/app.service';\nimport { LocalService } from '../../services/local.service';\nimport * as firebase from 'firebase/app';\n\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html',\n})\nexport class HomePage {\n  USER_LOCATION: iPosition;\n  USER_LAST_TIME: string;\n  USER_ID = null;\n  IMG = '../../assets/imgs/menugo_192x192.png';\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private dbService: DbService,\n    private afAuth: AngularFireAuth,\n    private geolocation: Geolocation,\n    private appService: AppService,\n    private localService: LocalService\n  ) {\n    // this.test();\n    if (this.afAuth.auth.currentUser) {\n      this.USER_ID = this.afAuth.auth.currentUser.uid;\n    }\n    this.geolocation.getCurrentPosition()\n      .then((res) => {\n        console.log(res);\n        this.USER_LOCATION = {\n          lat: res.coords.latitude,\n          lng: res.coords.longitude\n        };\n        this.getShopsNearby(this.USER_LOCATION.lat, this.USER_LOCATION.lng);\n      })\n      .catch((err) => {\n        console.log(err);\n        if (this.USER_ID) {\n          let UID = this.USER_ID;\n          this.dbService.getOneItemReturnPromise('UserPosition/' + UID).then((res: any) => {\n            this.USER_LOCATION = res.LAST_POSITION;\n            this.USER_LAST_TIME = res.TIME;\n            console.log(res);\n            this.getShopsNearby(this.USER_LOCATION.lat, this.USER_LOCATION.lng);\n          })\n            .catch((err) => {\n              this.USER_LOCATION = { lat: 10.778168043677463, lng: 106.69638633728027 };\n              this.getShopsNearby(this.USER_LOCATION.lat, this.USER_LOCATION.lng);\n            })\n        }\n      })\n  }\n\n\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad HomePage');\n  }\n\n  go2MapPage() {\n    this.navCtrl.setRoot('MapPage', { LOC: this.USER_LOCATION });\n  }\n\n  getShopsNearby(LAT: number, LNG: number) {\n    let latArray: any[] = [];\n    let lngArray: any[] = [];\n    let itemArray: any[] = [];\n    let db = firebase.database();\n    const loca = db.ref('ShopsLOCATION');\n    const query1 = loca\n      .orderByChild('lat')\n      .startAt(LAT - 0.1)\n      .endAt(LAT + 0.1)\n    let pro1 = query1.once('value', snap => {\n      console.log(snap);\n      snap.forEach((child: any) => {\n        console.log(child.val(), child.key)\n        latArray.push(child.key);\n        itemArray.push(child.val());\n        return false\n      })\n    })\n\n    const query2 = loca\n      .orderByChild('lng')\n      .startAt(LNG - 0.1)\n      .endAt(LNG + 0.2)\n    let pro2 = query2.once('value', snap => {\n      console.log(snap);\n      snap.forEach((child: any) => {\n        console.log(child.val(), child.key)\n        lngArray.push(child.key);\n        return false\n      })\n    })\n\n    Promise.all([pro1, pro2]).then(() => {\n      let final = this.appService.commonOf2Arrays(latArray, lngArray);\n      console.log(final);\n      this.localService.SHOPs_NEARBY = final;\n      let finalLOC = [];\n      final.forEach(ID=>{\n        let index = latArray.indexOf(ID);\n        finalLOC.push(itemArray[index]);\n      })\n      this.localService.SHOPs_LOCATION = finalLOC;\n      console.log(finalLOC);\n      this.localService.shopsLoaded = true;\n    })\n  }\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}