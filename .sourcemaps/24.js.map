{"version":3,"sources":["../../src/pages/history/history.module.ts","../../src/pages/history/history.ts"],"names":[],"mappings":"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","file":"24.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HistoryPage } from './history';\n\n@NgModule({\n  declarations: [\n    HistoryPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(HistoryPage),\n  ],\n  exports: [\n    HistoryPage\n  ]\n})\nexport class HistoryPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/history/history.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController } from 'ionic-angular';\n\nimport { LocalService } from '../../services/local.service';\nimport { AngularFireService } from '../../services/af.service';\nimport { AppService } from '../../services/app.service';\nimport { DbService } from '../../services/db.service';\n\nimport { iItem } from '../../interfaces/item.interface';\nimport { iOrder } from '../../interfaces/order.interface';\nimport { iShop } from '../../interfaces/shop.interface';\nimport { iOrderList } from '../../interfaces/order-list.interface';\n@IonicPage()\n@Component({\n  selector: 'page-history',\n  templateUrl: 'history.html',\n})\nexport class HistoryPage {\n\n  DATE: any = '2017/07/23';\n  selectedDate: string = null;\n  SHOPs: iShop[] = [];\n  USER_ID: string;\n  SHOPS_ITEMS: iItem[] = [];\n  SHOPS_ITEMS_ID: any[] = [];\n  SHOPS_ORDERS: any[] = [];\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private alertCtrl: AlertController,\n    private localService: LocalService,\n    private appService: AppService,\n    private dbService: DbService,\n    private afService: AngularFireService\n  ) {\n    this.DATE = this.appService.getCurrentDate();\n    // 1. get and set current date as default date\n    this.selectedDate = this.appService.convertDateFormat1(this.DATE);\n    this.USER_ID = this.localService.USER_ID;\n\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad YourOrdersPage');\n  }\n\n  ionViewWillEnter() {\n    this.selectedDate = this.appService.convertDateFormat1(this.DATE);\n    setTimeout(() => {\n      this.getUserID();\n    }, 1000);\n  }\n\n\n  getUserID() {\n    console.log(this.USER_ID);\n    if (this.USER_ID == null) {\n      if (this.afService.getAuth().auth.currentUser) {\n        this.USER_ID = this.afService.getAuth().auth.currentUser.uid;\n      } else {\n        this.showConfirm();\n      }\n      this.DATE = this.appService.getCurrentDate();\n      this.initGetYourOrder();\n    }\n  }\n\n  initGetYourOrder() {\n    console.log(this.USER_ID, this.DATE);\n    this.localService.getSHOPs_ID(this.USER_ID, this.DATE)\n      .then((shop_id_list: string[]) => {\n        console.log(shop_id_list);\n        if (shop_id_list.length > 0) {\n          this.SHOPS_ITEMS = [];\n          this.SHOPS_ITEMS_ID = [];\n          shop_id_list.forEach(shop_id => {\n            this.localService.getSHOP_ITEMSnSHOP_ITEMS_ID(shop_id).then((data: any) => {\n              console.log(data);\n              this.SHOPS_ITEMS = this.SHOPS_ITEMS.concat(data.SHOP_ITEMS);\n              this.SHOPS_ITEMS_ID = this.SHOPS_ITEMS_ID.concat(data.SHOP_ITEMS_ID);\n            })\n              .then(() => {\n                console.log(this.SHOPS_ITEMS);\n                console.log(this.SHOPS_ITEMS_ID);\n              })\n              .then(() => {\n                this.getOrderDetail();\n              })\n\n            this.SHOPs = [];\n            this.dbService.getOneItemReturnPromise('Shops/' + shop_id).then((shop: iShop) => {\n              this.SHOPs.push(shop);\n            })\n          });\n          console.log(this.SHOPs);\n          console.log(this.SHOPS_ITEMS, this.SHOPS_ITEMS_ID);\n        } else {\n          this.SHOPS_ORDERS = [];\n        }\n      })\n      .catch((err)=>{\n        console.log(err);\n        this.SHOPS_ORDERS = [];\n      })\n  }\n\n  getOrderDetail() {\n    console.log('Done init');\n    // 1. Get array of order_url of user on one date\n    this.localService.getORDERS_IDOfUser(this.USER_ID, this.DATE).then((ORDER_URLs: any[]) => {\n      console.log('Orders Url', ORDER_URLs);\n      this.SHOPS_ORDERS = [];\n      ORDER_URLs.forEach(ORDER_URL => {\n        // 2. From order_url, get detail of order\n        this.dbService.getOneItemReturnPromise(ORDER_URL).then((ORDER_DETAIL: iOrder) => {\n          console.log('Order detail:', ORDER_DETAIL);\n          let ORDER_LIST_NEW = [];\n          let TOTAL_PRICE = 0;\n          // 3. From each ORDER.ORDER_LIST, get additional to 'ORDER_LIST_NEW' and TOTAL_PRICE\n          ORDER_DETAIL.ORDER_LIST.forEach((orderList: iOrderList) => {\n            let index = this.SHOPS_ITEMS_ID.indexOf(orderList.item);\n            ORDER_LIST_NEW.push({ item: this.SHOPS_ITEMS[index], amount: orderList.amount });\n            let PRICE = orderList.amount * this.SHOPS_ITEMS[index].ITEM_PRICE;\n            TOTAL_PRICE += PRICE;\n          })\n          ORDER_DETAIL['ORDER_LIST_NEW'] = ORDER_LIST_NEW;\n          ORDER_DETAIL['TOTAL_PRICE'] = TOTAL_PRICE;\n          this.SHOPS_ORDERS.push(ORDER_DETAIL);\n        })\n      });\n      console.log('SHOPS_ORDERS:', this.SHOPS_ORDERS);\n    })\n  }\n\n\n  go2OrderDetail(order: iOrder, i) {\n    console.log(order, i);\n    console.log(this.SHOPs);\n    let res = null;\n    this.SHOPs.forEach((SHOP) => {\n      if (SHOP.SHOP_ID === order.ORDER_SHOP_ID) {\n        res = SHOP\n      }\n    })\n    console.log(res);\n    this.navCtrl.push('OrderDetailPage', { ORDER: order, SHOP: res });\n  }\n\n  selectDate() {\n    console.log(this.selectedDate);\n    if (this.selectedDate != null) {\n      this.DATE = this.selectedDate.substr(0, 4) + '/' + this.selectedDate.substr(5, 2) + '/' + this.selectedDate.substr(8, 2);\n    } else {\n      this.appService.alertMsg('Alert', 'Choose date to show');\n    }\n    console.log(this.DATE);\n    this.initGetYourOrder();\n  }\n\n  showConfirm() {\n    let confirm = this.alertCtrl.create({\n      title: 'Alert!',\n      message: 'Please login to use this feature',\n      buttons: [\n        {\n          text: 'Cancel',\n          handler: () => {\n            console.log('Disagree clicked');\n          }\n        },\n        {\n          text: 'OK',\n          handler: () => {\n            this.navCtrl.push('AccountPage', { action: 'request-login' });\n          }\n        }\n      ]\n    });\n    confirm.present();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/history/history.ts"],"sourceRoot":""}